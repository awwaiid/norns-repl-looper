import{r as e,n as l,c as t,a as o,F as n,b as s,w as r,v as a,d as i,e as c,o as u,t as d,f as v,u as g,g as f,h as p,i as m}from"./vendor.2232f11a.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))l(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&l(e)})).observe(document,{childList:!0,subtree:!0})}function l(e){if(e.ep)return;e.ep=!0;const l=function(e){const l={};return e.integrity&&(l.integrity=e.integrity),e.referrerpolicy&&(l.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?l.credentials="include":"anonymous"===e.crossorigin?l.credentials="omit":l.credentials="same-origin",l}(e);fetch(e.href,l)}}();const h={class:"flex flex-col h-full bg-black text-white"},y={class:"flex items-center"},w=o("div",{class:"flex flex-col items-center m-2"},[o("img",{alt:"REPL-LOOPER logo",src:"/api/v1/dust/code/repl-looper/ui/dist/assets/logo-dark.482a0739.png",width:"50"}),o("h1",{class:"text-m"},"REPL-LOOPER")],-1),x={class:"flex flex-col m-2 p-0"},b={class:"flex flex-row items-center"},S={class:"text-xs mr-1",style:{"line-height":"0.5"}},E={key:1,style:{width:"0.5rem",height:"0.5rem",border:"1px solid #888"}},k={class:"text-xs ml-1",style:{"line-height":"0.5"}},O={class:"flex flex-col h-full min-h-0 border-2 border-gray-800 m-1 p-2"},L={class:"grid grid-cols-3 min-h-0"},N={class:"special-scrollbar col-span-2 overflow-y-scroll overflow-x-hidden",id:"messages"},R={class:"line"},P={class:"flex-1 overflow-y-scroll overflow-x-hidden text-red-400 text-xs",id:"server-messages"},I={class:"line"},_={class:"w-full flex-none flex items-center"},A={class:"flex-grow w-full border-2 border-gray-800"},J=["onKeydown"],j={components:{REPL:{setup(f){function p(e,l,t="\n"){var o=1;l&&"number"==typeof l&&(o=l,l="");var n=typeof e;if(~["number","boolean"].indexOf(n))return e;if("string"===n)return'"'+(e.replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/"/g,'\\"').replace(/\\$/g,"\\\\")+'"');if("undefined"===n||null===e)return"nil";var s=0,r=l||"";for(l=l||"";s<o;l+=" ",s++);if(Array.isArray(e)){let t="{"+e.map((function(e){return p(e)})).join(", ")+"}";return t.length>120?"{\n"+l+e.map((function(e){return p(e,l)})).join(",\n"+l)+"\n"+r+"}":t}{var a=[];for(var i in e)a.push(i+(o?" = "+p(e[i],l):" = "+p(e[i])));let t="{"+a.join(", ")+"}";return t.length>120?"{\n"+l+a.join(",\n"+l)+"\n"+r+"}":t}}const m=e(""),j=e([]),q=e([]),V=e(!1),K=e([]),M=e([]),U=e([]),F=e([]),W=e([]);console.log("Starting connection to WebSocket Server");const C=new WebSocket("ws://norns.local:5555/",["bus.sp.nanomsg.org"]);let D="";async function G(){await l();const e=document.querySelector("#messages .line:last-child");console.log("scrolling to bottom to",e),e&&e.scrollIntoView({block:"end"})}async function $(){await l();const e=document.querySelector("#messages .line .historySelected");console.log("Srolling to",e),e.scrollIntoView({block:"nearest"})}function z(){const e=document.querySelector("#command-input"),l=e.value.length;console.log("moving cursor to end",e,l),e.focus(),e.setSelectionRange(l,l)}C.onmessage=async e=>{console.log("got message",e),console.log("got message data length",e.data.length),console.log("last char",e.data.substring(e.data.length-10));let t=e.data;if(4095==t.length||1==t.length)return void(D+=t);t=D+t,D="";let o=t.match(/SERVER MESSAGE: (.*)/);if(o){let e=JSON.parse(o[1]);if(console.log("msg: ",e),"playback_step"==e.action){const l=parseInt(e.loop_id)-1;K.value[l]=parseInt(e.step),M.value[l]=Math.ceil(parseFloat(e.stepCount)),U.value[l]=e.command,F.value[l]=e.mode,W.value[l]=e.loop_letter}return}if(o=t.match(/RESPONSE:(.*)/),o){let e=JSON.parse(o[1]);return console.log("msg: ",e),void("live_event"==e.action&&void 0!==e.result?(console.log("JS2LUA:","["+p(e.result,null,2)+"]",typeof p(e.result,null,2)),j.value.push(String(p(e.result,null,2))),await G()):"completions"==e.action&&void 0!==e.result&&e.result.length>0&&Array.isArray(e.result)&&(console.log("completions:",e.result),e.result.length>1&&e.result.forEach((e=>{j.value.push(e)})),m.value=function(e){if(!e[0]||1==e.length)return e[0]||"";let l=0;for(;e[0][l]&&e.every((t=>t[l]===e[0][l]));)l++;return e[0].substr(0,l)}(e.result),z(),await G()))}if(t.match(/ParamSet/))return;const n=t.trim();n&&(q.value.push("â†’ ["+n+"]"),await async function(){await l();const e=document.querySelector("#server-messages .line:last-child");console.log("scrolling to bottom to",e),e.scrollIntoView({block:"nearest"})}())},C.onopen=e=>{console.log("on open",e),console.log("Successfully connected to the echo websocket server..."),V.value=!0},C.onclose=()=>{V.value=!1};let B=e(void 0);async function H(e){console.log("historyUp",{v:e}),B.value?(B.value=B.value-1,B.value<0&&(B.value=j.value.length-1)):B.value=j.value.length-1,m.value=j.value[B.value],await $(),z()}async function Q(e){console.log("historyDown",{v:e}),null==B.value?B.value=0:(B.value=B.value+1,B.value>=j.value.length&&(B.value=0)),m.value=j.value[B.value],await $(),z()}async function T(e){console.log("gotInput",{v:e});let l=e.target.value;l||(l=j.value[j.value.length-1]),j.value.push(l),B.value=void 0,await G(),m.value="",console.log("Sending to norns: live_event("+JSON.stringify(l)+")\n"),C.send("client_live_event("+JSON.stringify(l)+")\n")}async function X(e){console.log("gotInput",{v:e});const l=e.target.value;B.value=void 0,console.log("Sending to norns: live_event("+JSON.stringify(l)+")\n"),C.send("completions("+JSON.stringify(l)+")\n")}return(e,l)=>(u(),t("div",h,[o("div",y,[w,o("div",x,[(u(!0),t(n,null,s(M.value,((e,l)=>(u(),t("div",b,[o("div",S,[o("pre",null,[o("code",null,d(W.value[l]),1)])]),(u(!0),t(n,null,s(M.value[l],(e=>(u(),t("div",null,[K.value[l]===e?(u(),t("div",{key:0,style:{width:"0.5rem",height:"0.5rem",border:"1px solid #888"},class:v("recording"==F.value[l]?"bg-red-700":"bg-white")},null,2)):(u(),t("div",E))])))),256)),o("div",k,[o("pre",null,[o("code",null,d(U.value[l]),1)])])])))),256))])]),o("div",O,[o("div",L,[o("div",N,[(u(!0),t(n,null,s(j.value,((e,l)=>(u(),t("div",R,[o("pre",{class:v({historySelected:g(B)==l,historyNotSelected:g(B)!==l})},d(e.trimEnd()),3)])))),256))]),o("div",P,[(u(!0),t(n,null,s(q.value,((e,l)=>(u(),t("div",I,[o("pre",null,d(e.trimEnd()),1)])))),256))])]),o("div",_,[o("div",A,[r(o("textarea",{id:"command-input",class:"w-full bg-black text-white outline-none",type:"text",rows:"3",autofocus:"",onKeydown:[i(c(T,["exact","prevent"]),["enter"]),i(c(H,["exact","prevent"]),["arrow-up"]),i(c(H,["ctrl","exact","prevent"]),["113"]),i(c(H,["ctrl","exact","prevent"]),["107"]),i(c(Q,["exact","prevent"]),["arrow-down"]),i(c(X,["prevent"]),["tab"])],"onUpdate:modelValue":l[0]||(l[0]=e=>m.value=e)},null,40,J),[[a,m.value]])])])])]))}}},mounted(){}};j.render=function(e,l,t,o,n,s){const r=f("REPL");return u(),p(r)};m(j).mount("#app");
