import{r as e,n as l,c as o,a as n,F as t,b as s,w as r,v as a,d as i,e as c,o as u,t as v,f as d,u as g,g as f,h as p,i as m}from"./vendor.2232f11a.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))l(e);new MutationObserver((e=>{for(const o of e)if("childList"===o.type)for(const e of o.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&l(e)})).observe(document,{childList:!0,subtree:!0})}function l(e){if(e.ep)return;e.ep=!0;const l=function(e){const l={};return e.integrity&&(l.integrity=e.integrity),e.referrerpolicy&&(l.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?l.credentials="include":"anonymous"===e.crossorigin?l.credentials="omit":l.credentials="same-origin",l}(e);fetch(e.href,l)}}();const h={class:"flex flex-col h-full bg-black text-white"},y={class:"flex items-center"},w=n("img",{class:"m-4",alt:"REPL-LOOPER logo",src:"/api/v1/dust/code/repl-looper/ui/dist/assets/logo-dark.482a0739.png",width:"50"},null,-1),x=n("h1",{class:"text-3xl m-2"},"REPL-LOOPER",-1),b={class:"flex flex-col m-2 p-0"},S={class:"flex flex-row"},E={class:"text-xs"},k={key:1,style:{width:"1rem",height:"1rem",border:"1px solid #888"}},O={class:"text-xs"},L={class:"flex flex-col h-full min-h-0 border-2 border-gray-800 m-2 p-2"},N={class:"grid grid-cols-3 min-h-0"},R={class:"special-scrollbar col-span-2 overflow-y-scroll overflow-x-hidden",id:"messages"},P={class:"line"},I={class:"flex-1 overflow-y-scroll overflow-x-hidden text-red-400 text-xs",id:"server-messages"},A={class:"line"},J={class:"w-full flex-none flex items-center"},_={class:"flex-grow w-full border-2 border-gray-800"},j=["onKeydown"],q={components:{REPL:{setup(f){function p(e,l,o="\n"){var n=1;l&&"number"==typeof l&&(n=l,l="");var t=typeof e;if(~["number","boolean"].indexOf(t))return e;if("string"===t)return'"'+(e.replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/"/g,'\\"').replace(/\\$/g,"\\\\")+'"');if("undefined"===t||null===e)return"nil";var s=0,r=l||"";for(l=l||"";s<n;l+=" ",s++);if(Array.isArray(e)){let o="{"+e.map((function(e){return p(e)})).join(", ")+"}";return o.length>120?"{\n"+l+e.map((function(e){return p(e,l)})).join(",\n"+l)+"\n"+r+"}":o}{var a=[];for(var i in e)a.push(i+(n?" = "+p(e[i],l):" = "+p(e[i])));let o="{"+a.join(", ")+"}";return o.length>120?"{\n"+l+a.join(",\n"+l)+"\n"+r+"}":o}}const m=e(""),q=e([]),V=e([]),K=e(!1),M=e([]),U=e([]),F=e([]),W=e([]),C=e([]);console.log("Starting connection to WebSocket Server");const D=new WebSocket("ws://norns.local:5555/",["bus.sp.nanomsg.org"]);let G="";async function $(){await l();const e=document.querySelector("#messages .line:last-child");console.log("scrolling to bottom to",e),e&&e.scrollIntoView({block:"end"})}async function z(){await l();const e=document.querySelector("#messages .line .historySelected");console.log("Srolling to",e),e.scrollIntoView({block:"nearest"})}function B(){const e=document.querySelector("#command-input"),l=e.value.length;console.log("moving cursor to end",e,l),e.focus(),e.setSelectionRange(l,l)}D.onmessage=async e=>{console.log("got message",e);let o=e.data;if(4095==o.length)return void(G+=o);o=G+o,G="";let n=o.match(/SERVER MESSAGE: (.*)/);if(n){let e=JSON.parse(n[1]);if(console.log("msg: ",e),"playback_step"==e.action){const l=parseInt(e.loop_id)-1;M.value[l]=parseInt(e.step),U.value[l]=Math.ceil(parseFloat(e.stepCount)),F.value[l]=e.command,W.value[l]=e.mode,C.value[l]=e.loop_letter}return}if(n=o.match(/RESPONSE:(.*)/),n){let e=JSON.parse(n[1]);return console.log("msg: ",e),void("live_event"==e.action&&void 0!==e.result?(console.log("JS2LUA:","["+p(e.result,null,2)+"]",typeof p(e.result,null,2)),q.value.push(String(p(e.result,null,2))),await $()):"completions"==e.action&&void 0!==e.result&&e.result.length>0&&Array.isArray(e.result)&&(console.log("completions:",e.result),e.result.length>1&&e.result.forEach((e=>{q.value.push(e)})),m.value=function(e){if(!e[0]||1==e.length)return e[0]||"";let l=0;for(;e[0][l]&&e.every((o=>o[l]===e[0][l]));)l++;return e[0].substr(0,l)}(e.result),B(),await $()))}if(o.match(/ParamSet/))return;const t=o.trim();t&&(V.value.push("â†’ ["+t+"]"),await async function(){await l();const e=document.querySelector("#server-messages .line:last-child");console.log("scrolling to bottom to",e),e.scrollIntoView({block:"nearest"})}())},D.onopen=e=>{console.log("on open",e),console.log("Successfully connected to the echo websocket server..."),K.value=!0},D.onclose=()=>{K.value=!1};let H=e(void 0);async function Q(e){console.log("historyUp",{v:e}),H.value?(H.value=H.value-1,H.value<0&&(H.value=q.value.length-1)):H.value=q.value.length-1,m.value=q.value[H.value],await z(),B()}async function T(e){console.log("historyDown",{v:e}),null==H.value?H.value=0:(H.value=H.value+1,H.value>=q.value.length&&(H.value=0)),m.value=q.value[H.value],await z(),B()}async function X(e){console.log("gotInput",{v:e});let l=e.target.value;l||(l=q.value[q.value.length-1]),q.value.push(l),H.value=void 0,await $(),m.value="",console.log("Sending to norns: live_event("+JSON.stringify(l)+")\n"),D.send("live_event("+JSON.stringify(l)+")\n")}async function Y(e){console.log("gotInput",{v:e});const l=e.target.value;H.value=void 0,console.log("Sending to norns: live_event("+JSON.stringify(l)+")\n"),D.send("completions("+JSON.stringify(l)+")\n")}return(e,l)=>(u(),o("div",h,[n("div",y,[w,x,n("div",b,[(u(!0),o(t,null,s(U.value,((e,l)=>(u(),o("div",S,[n("div",E,[n("pre",null,[n("code",null,v(C.value[l]),1)])]),(u(!0),o(t,null,s(U.value[l],(e=>(u(),o("div",null,[M.value[l]===e?(u(),o("div",{key:0,style:{width:"1rem",height:"1rem",border:"1px solid #888"},class:d("recording"==W.value[l]?"bg-red-700":"bg-white")},null,2)):(u(),o("div",k))])))),256)),n("div",O,[n("pre",null,[n("code",null,v(F.value[l]),1)])])])))),256))])]),n("div",L,[n("div",N,[n("div",R,[(u(!0),o(t,null,s(q.value,((e,l)=>(u(),o("div",P,[n("pre",{class:d({historySelected:g(H)==l,historyNotSelected:g(H)!==l})},v(e.trimEnd()),3)])))),256))]),n("div",I,[(u(!0),o(t,null,s(V.value,((e,l)=>(u(),o("div",A,[n("pre",null,v(e.trimEnd()),1)])))),256))])]),n("div",J,[n("div",_,[r(n("textarea",{id:"command-input",class:"w-full bg-black text-white outline-none",type:"text",rows:"5",autofocus:"",onKeydown:[i(c(X,["exact","prevent"]),["enter"]),i(c(Q,["exact","prevent"]),["arrow-up"]),i(c(Q,["ctrl","exact","prevent"]),["113"]),i(c(Q,["ctrl","exact","prevent"]),["107"]),i(c(T,["exact","prevent"]),["arrow-down"]),i(c(Y,["prevent"]),["tab"])],"onUpdate:modelValue":l[0]||(l[0]=e=>m.value=e)},null,40,j),[[a,m.value]])])])])]))}}},mounted(){}};q.render=function(e,l,o,n,t,s){const r=f("REPL");return u(),p(r)};m(q).mount("#app");
